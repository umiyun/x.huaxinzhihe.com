{template 'header_making'}
<link rel="stylesheet" type="text/css" href="{YOUMI_URL_APP}hui/hui.css" />
<script type="text/javascript" src="{YOUMI_URL_APP}hui/hui.js" charset="utf-8"></script>
<script type="text/javascript" src="{YOUMI_URL_APP}hui/hui-picker.js" charset="utf-8"></script>
<script type="text/javascript" src="{YOUMI_URL_APP}hui/cities.js" charset="utf-8"></script>
<style>
    *{box-sizing: inherit;}
    div{
        font-size: 12px;
    }

    .a_content{
        padding: 4%;
        box-sizing: border-box;
        padding-bottom: 35%;
        background: #ddd;
    }

    input[type=color], input[type=date], input[type=datetime-local], input[type=datetime], input[type=email], input[type=month], input[type=number], input[type=password], input[type=search], input[type=tel], input[type=text], input[type=time], input[type=url], input[type=week], select{
        border: 1px dashed #F9292A;
        text-align: center;
        margin: 0 2%;
        height: 30px;
        padding: 5px;
        background: transparent;
    }
    .basic_setting{
        background: #E4FCFA;
        border: 1px solid #111;
        border-radius: 10px;
        padding: 2%;
        padding-top: 25px;
        margin-top: 35px;
    }

    .p_gimg{
        text-align: center;
        border: 1px solid #aaa;
        width: 110px;
        height: 110px;
        overflow: hidden;
        background: #fff;
    }
    .p_gimg>span{
        position: absolute;
        top: 0;
        left: 0;
        background: #F7DA79;
        z-index: 8;
    }
    .p_price{
        margin-left: 4%;
    }
    input.select_goodimg,input.select_good2img{
        opacity: 0;
    }
    .p_gimg .select_goodimg,.p_gimg .good_logo,.select_good2img,.ac_btns .select_goodimg{
        position: absolute;
        z-index: 10;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
    .p_gimg .good_logo{
        z-index: 5;
    }
    .p_price input{
        width: 80%;
    }
    .s_nums{
        margin-top: 2%;
    }
    .s_goodimg{
        border: 1px dashed #F9292A;
        margin: 4% 0;
        text-align: center;
        border-radius: 3px;
        width: 100%;
        min-height: 100px;
        margin-bottom: 0;
    }
    .s_goodimg>div{
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        z-index: 2;
    }
    .s_goodimg>img.good_logo{
        position: relative;
        top: 0;
        width: 100%;
        left: 0;
        z-index: 5;
    }

    .c_addbtn{
        text-align: center;
    }
    .c_addbtn>div{
        display: inline-block;
        border: 1px solid #98C1EC;
        margin: 5%;
        padding: 2% 6%;
        border-radius: 4px;
    }
    .c_addbtn i.iconfont{
        color: #98C1EC;
        font-size: 20px;
    }
    .s_intro{
        position: absolute;
        top: -25px;
        width: 70%;
        left: 15%;
    }
    .s_intro img{
        position: absolute;
        width: 100%;
        height: 40px;
        left: 0;
        top: 0;
        z-index: 3;
    }
    .s_intro input{
        position: absolute;
        width: 100%;
        top: 0;
        left: 0;
        z-index: 5;
    }
    .iconfont.icon-essential{
        color: red;
        font-size: 12px;
    }
    .s_close{
        position: absolute;
        top: -33px;
        right: 0px;
        z-index: 10;
        font-size: 40px;
        color: red;
    }

    .s_detail .weui-cells:after, .weui-cells:before,.s_detail .weui-cell:before{
        display: none;
    }
    .s_detail label.weui-cell{
        padding: 0 10px;
    }
    .weui-cells_checkbox .weui-icon-checked:before{
        font-size: 20px;
    }

    .ceg_title,.cer_title{
        text-align: center;
        margin-bottom: 5%;
    }
    .ceg_title>img,.cer_title>img{
        width: 60%;
        height: 40px;
    }
    .ceg_title>span,.cer_title>span{
        position: absolute;
        bottom: -14px;
        right: 0;
        width: 100%;
    }


    .ce_common,.ce_lingqu,.ce_rule{
        margin-top: 25px;
    }
    .ce_common input,.ce_lingqu .cegt_input,.cer_title input{
        /*border: 1px solid transparent;*/
        width: 38%;
        top: 10%;
        left: 29%;
        position: absolute;
        z-index: 5;
    }
    .ceg_content,.ces_content,.cel_content,.cer_content{
        background: #fff;
        border-radius: 5px;
        padding: 2%;
    }
    .csys_content,.csms_content,.csgs_content{
        margin-bottom: 12%;
    }
    .csycc_num{
        padding: 2%;
        background: #D8D8D8;
        margin: 1%;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        text-align: center;
    }
    .csycc_btns,.csmcc_btns,.common_btns{
        position: absolute;
        right: 0;
        bottom: -20px;
        z-index: 5;
    }
    .csmcc_btns{
        bottom: -14px;
    }
    .csycc_btns div,.csmcc_btns div,.common_btns div{
        background: #aaa;
        padding: 0 4%;
        border-left: 1px solid #fff;
        word-break: break-all;
        color: #fff;
        text-align: center;
        width: 60px;
    }
    .ceyc_btns{
        margin-top: 20%;
    }
    .ceyc_btns i.iconfont{
        color: #98C1EC;
    }
    .ceyc_btns>div{
        display: inline-block;
        border: 1px solid #98C1EC;
        padding: 1% 4%;
        background: #D6E9FC;
    }

    .ces_btns{
        padding: 2%;
    }
    .ces_btns i{
        font-size: 30px;
        color: #98C1EC;
    }
    .ces_btns .ft16{
        margin-top: -10px;
    }

    .cess_content{
        margin-bottom: 40px;
    }
    .cess_content .common_btns{
        bottom: -25px;
    }

    .cel_content>div{
        margin-bottom: 10px;
    }
    .ce_common .cel_content input{
        position: inherit;
        flex: 1;
        margin: 0 6%;
    }

    .cel_content input.weui-check{
        display: none!important;
    }
    .cel_content .weui-cell.weui-check__label{
        margin: 0;
    }
    .cel_content .weui-cells:after{
        display: none;
    }
    .weui-cells{
        margin-top: 0;
    }
    .icon-suo{
        color: red;
        position: relative;
        left: 20%;
    }


    .bg_fixed{
        position: fixed;
        top: 0;
        left: 0;
        z-index: 15;
        width: 100%;
        height: 100%;
        display: none;
    }
    .footer_btns{
        position: fixed;
        z-index: 15;
        bottom: 0;
        width: 100%;
        left: 0;
        color: #fff;
    }
    .fb_btns{
        background: #fff;
    }
    .fb_btns>div{
        width: 50%;
        font-size: 20px;
        text-align: center;
        padding: 8px;
    }
    .fb_tip{
        padding: 1% 5%;
        background: rgba(0,0,0,0.7);
    }
    .go_top{
        position: fixed;
        bottom: 20%;
        right: 5%;
        width: 40px;
        height: 40px;
        z-index: 20;
        color: #fff;
        border-radius: 50%;
        background: rgba(0,0,0,0.6);
        text-align: center;
        line-height: 18px;
        padding: 6px;
        display: none;
    }
    .a_changeimg .weui-cells:after{
        display: none;
    }
    .weui-check__label:active {
        background-color: transparent;
    }
    .a_changeimg .weui-cells_checkbox .weui-check:checked+.weui-icon-checked:before{
        color: #E18F3D;
    }

    .d_receive_time,.d_receive_name,.d_receive_address{
        display: block;
        width: 96%!important;
        margin-bottom: 6px!important;
    }
    .weui-cells{
        background: transparent;
    }
    .weui-cell:before,.weui-cells:after{
        display: none;
    }

    .weui-switch{
        margin-left: 20px;
    }
</style>

<div>

    <!--头部-->
    {template 'temp/activity_head_music'}
    <!--下部分，背景图片 background->repeat-->
    <div class="a_content">
        <!--活动标题,时间-->
        {template 'temp/activity_title'}

        <div class="c_setting">
            <!--规则设置-->
            <div class="ce_rule">
                <div class="cer_title p_relative">
                    <img class="titlebgimg" src="{if $activity['titlebgimg']}{$activity['titlebgimg']}{else}{YOUMI_URL_APP}img/m_titlebg2.png{/if}" alt="">
                    <input class="border_transparent" type="text" value="规则设置" readonly>
                </div>
                <div class="cer_content">
                    <div class="s_detail">
                        <div class="flex flex_a_center">
                            <span class="word-break"><i class="iconfont icon-essential"></i>奖品模式</span>
                            <div class="weui-cells weui-cells_radio">
                                <label class="weui-cell weui-check__label" for="audit1">
                                    <div class="weui-cell__bd">
                                        <div class="word-break">红包</div>
                                    </div>
                                    <div class="weui-cell__ft">
                                        <input onclick="$('.prize_setting').show();$('.prize_setting2').hide()" name="audit" type="radio" class="d_prize_status weui-check" id="audit1" value="1" {if $activity['prize_status']==1}checked{/if} />
                                        <span class="weui-icon-checked"></span>
                                    </div>
                                </label>
                                <label class="weui-cell weui-check__label" for="audit2">
                                    <div class="weui-cell__bd">
                                        <div class="word-break">奖品</div>
                                    </div>
                                    <div class="weui-cell__ft">
                                        <input onclick="$('.prize_setting').hide();$('.prize_setting2').show()" name="audit" type="radio" class="d_prize_status weui-check" id="audit2" value="2" {if $activity['prize_status']!=1}checked{/if}>
                                        <span class="weui-icon-checked"></span>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="s_detail">
                        <div class="flex flex_a_center">
                            <i class="iconfont icon-essential"></i>
                            <span class="word-break">差值</span>
                            <input type="text" class="d_diff" value="{$activity['diff']}">
                        </div>
                        <div class="ft10 color777" style="margin-bottom: 10px">例如：0.2 则9.8-10.2 之间的用户都会发送随机红包或参与抽奖</div>
                    </div>
                    <div class="s_detail">
                        <div class="flex flex_a_center">
                            <i class="iconfont icon-essential"></i>
                            <span class="word-break">每日初始次数</span>
                            <input type="number" class="d_daynum" value="{$activity['daynum']}">
                        </div>
                    </div>
                    <div class="s_detail">
                        <div class="flex flex_a_center">
                            <i class="iconfont icon-essential"></i>
                            <span class="word-break">每日上限次数（包括初始次数）</span>
                            <input type="number" class="d_allnum" value="{$activity['allnum']}">
                        </div>
                    </div>
                </div>
                <div class="cer_content prize_setting" style="{if $activity['prize_status']!=1}display: none;{/if}margin-top:10px;">
                    <div class="s_detail">
                        <div class="flex flex_a_center">
                            <i class="iconfont icon-essential"></i>
                            <span class="word-break">红包金额</span>
                            <input type="text" class="d_min_redpack" value="{$activity['min_redpack']}">
                            <input type="text" class="d_max_redpack" value="{$activity['max_redpack']}">
                        </div>
                        <div class="ft10 color777">请填写 最低值(最低1元) 和最高值</div>
                    </div>
                    <div class="s_detail">
                        <div class="flex flex_a_center">
                            <i class="iconfont icon-essential"></i>
                            <span class="word-break">中奖概率</span>
                            <input type="text" class="d_random" value="{$activity['random']}">
                        </div>
                        <div class="ft10 color777">请填写0-100之间的数字</div>
                    </div>
                    <div class="s_detail">
                        <div class="flex flex_a_center">
                            <i class="iconfont icon-essential"></i>
                            <span class="word-break">红包名称</span>
                            <input type="text" class="d_send_name" value="{$activity['send_name']}">
                        </div>
                        <div class="ft10 color777">模板消息</div>
                    </div>
                    <div class="s_detail">
                        <div class="flex flex_a_center">
                            <i class="iconfont icon-essential"></i>
                            <span class="word-break">发送红包祝福语</span>
                            <input type="text" class="d_wishing" value="{$activity['wishing']}">
                        </div>
                        <div class="ft10 color777">模板消息</div>
                    </div>
                    <div class="s_detail">
                        <div class="flex flex_a_center">
                            <i class="iconfont icon-essential"></i>
                            <span class="word-break">发送红包名称</span>
                            <input type="text" class="d_act_name" value="{$activity['act_name']}">
                        </div>
                        <div class="ft10 color777">模板消息</div>
                    </div>
                </div>
                <div class="cer_content prize_setting2" style="{if $activity['prize_status']==1}display: none;{/if}margin-top:10px;">
                    <div class="detail_html">
                        {if $activity['prizes']}
                        {loop $activity['prizes'] $apv}
                        <div class="basic_setting p_relative flex flex_wrap">
                            <!--图片 价格-->
                            <div class="s_price flex flex_wrap flex_j_between flex_a_center">
                                <div class="p_gimg p_relative flex_a_center">
                                    <input class="select_goodimg" type="file" accept="" onchange="selectGoodimg(this)">
                                    <div>
                                        <i class="iconfont icon-tupiantianjia" style="font-size: 30px"></i>
                                        <div class="color777 ft14">添加图片</div>
                                        <div class="color777 ft10">(只能添加一张)</div>
                                    </div>
                                    <img class="good_logo" src="{$apv['image']}" alt="">
                                    <input type="hidden" class="good_id" value="{$apv['id']}">
                                </div>
                                <div class="p_price flex1">
                                    <div class="s_detail" style="margin-bottom: 5px">
                                        <div class="flex flex_a_center">
                                            <span class="word-break"><i class="iconfont icon-essential"></i>奖品名称</span>
                                            <input type="text" class="d2_title" value="{$apv['title']}"/>
                                        </div>
                                    </div>
                                    <div class="s_detail" style="margin-bottom: 5px">
                                        <div class="flex flex_a_center">
                                            <span class="word-break"><i class="iconfont icon-essential"></i>中奖概率</span>
                                            <input type="number" class="d2_odds" value="{$apv['odds']}"/>
                                            <span>%</span>
                                        </div>
                                    </div>
                                    <div class="s_detail">
                                        <div class="flex flex_a_center">
                                            <span class="word-break"><i class="iconfont icon-essential"></i>奖品数量</span>
                                            <input type="number" class="d2_num" value="{$apv['num']}"/>
                                            <span>份</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--次数-->
                            <div class="s_nums weui-cell weui-cell_switch">
                                <div class="weui-cell__bd">是否中奖</div>
                                <div class="weui-cell__ft">
                                    <input class="weui-switch" type="checkbox" {if $apv['status']==1}checked{/if}>
                                </div>
                            </div>
                            <!--删除-->
                            <i onclick="$(this).parent().remove();" class="s_close iconfont icon-delete-s"></i>
                        </div>
                        {/loop}
                        {else}
                        {template 'temp/prize_detail'}
                        {/if}
                    </div>
                    <div class="c_addbtn">
                        <div class="ft16">
                            <i class="iconfont icon-jia"></i>
                            <span>添加奖品</span>
                        </div>
                    </div>
                </div>
                <div class="cer_content prize_setting3" style="margin-top:10px;">
                    <div class="s_detail">
                        <div class="s_goodimg p_relative">
                            <input class="select_good2img" type="file" onchange="selectGoodimg(this)">
                            <div>
                                <i class="iconfont icon-webicon308" style="font-size: 35px"></i>
                                <div class="color777 ft16" style="margin-top: -10px;">分享图</div>
                            </div>
                            <img class="good_logo d_s_image" {if !empty($activity['s_image'])}src="{$activity['s_image']}"{/if} alt="">
                        </div>
                        <div class="ft10 color777"><i class="iconfont icon-essential"></i>分享图</div>
                        <div class="flex flex_j_between">
                            <div class="s_goodimg p_relative">
                                <input class="select_good2img" type="file" onchange="selectGoodimg(this)">
                                <div>
                                    <i class="iconfont icon-webicon308" style="font-size: 35px"></i>
                                    <div class="color777 ft16" style="margin-top: -10px;">第一页背景图</div>
                                </div>
                                <img class="good_logo d_bgimage" {if !empty($activity['bgimage'])}src="{$activity['bgimage']}"{/if} alt="">
                            </div>
                        </div>
                        <div class="ft10 color777">第一页背景图(不填则为系统默认图片)</div>
                        <div class="s_goodimg p_relative">
                            <input class="select_good2img" type="file" onchange="selectGoodimg(this)">
                            <div>
                                <i class="iconfont icon-webicon308" style="font-size: 35px"></i>
                                <div class="color777 ft16" style="margin-top: -10px;">第一页logo</div>
                            </div>
                            <img class="good_logo d_logo" {if !empty($activity['logo'])}src="{$activity['logo']}"{/if} alt="">
                        </div>
                        <div class="ft10 color777">第一页logo(建议尺寸 750*150)</div>
                        <div class="flex flex_j_between">
                            <div class="s_goodimg p_relative">
                                <input class="select_good2img" type="file" onchange="selectGoodimg(this)">
                                <div>
                                    <i class="iconfont icon-webicon308" style="font-size: 35px"></i>
                                    <div class="color777 ft16" style="margin-top: -10px;">第一页主题</div>
                                </div>
                                <img class="good_logo d_titleimg" {if !empty($activity['titleimg'])}src="{$activity['titleimg']}"{/if} alt="">
                            </div>
                        </div>
                        <div class="ft10 color777">第一页主题(建议尺寸 750*250)</div>
                        <div class="flex flex_j_between" style="display: none">
                            <div class="s_goodimg p_relative">
                                <input class="select_good2img" type="file" onchange="selectGoodimg(this)">
                                <div>
                                    <i class="iconfont icon-webicon308" style="font-size: 35px"></i>
                                    <div class="color777 ft16" style="margin-top: -10px;">第二页背景图</div>
                                </div>
                                <img class="good_logo d_bgimage2" {if !empty($activity['bgimage2'])}src="{$activity['bgimage2']}"{/if} alt="">
                            </div>
                        </div>
                        <div class="ft10 color777" style="display: none">第二页背景图(不填则为系统默认图片)</div>
                        <div class="flex flex_j_between" style="display: none">
                            <div class="s_goodimg p_relative">
                                <input class="select_good2img" type="file" onchange="selectGoodimg(this)">
                                <div>
                                    <i class="iconfont icon-webicon308" style="font-size: 35px"></i>
                                    <div class="color777 ft16" style="margin-top: -10px;">第二页标题</div>
                                </div>
                                <img class="good_logo d_title2" {if !empty($activity['title2'])}src="{$activity['title2']}"{/if} alt="">
                            </div>
                        </div>
                        <div class="ft10 color777" style="display: none">第二页标题 建议尺寸 700*900 (不填则为系统默认图片)</div>
                        <div class="flex flex_j_between" style="display: none">
                            <div class="s_goodimg p_relative">
                                <input class="select_good2img" type="file" onchange="selectGoodimg(this)">
                                <div>
                                    <i class="iconfont icon-webicon308" style="font-size: 35px"></i>
                                    <div class="color777 ft16" style="margin-top: -10px;">第二页说明</div>
                                </div>
                                <img class="good_logo d_desc2" {if !empty($activity['desc2'])}src="{$activity['desc2']}"{/if} alt="">
                            </div>
                        </div>
                        <div class="ft10 color777" style="display: none">第二页说明</div>
                        <div class="flex flex_j_between">
                            <div class="s_goodimg p_relative">
                                <input class="select_good2img" type="file" onchange="selectGoodimg(this)">
                                <div>
                                    <i class="iconfont icon-webicon308" style="font-size: 35px"></i>
                                    <div class="color777 ft16" style="margin-top: -10px;">游戏页背景</div>
                                </div>
                                <img class="good_logo d_bgimage3" {if !empty($activity['bgimage3'])}src="{$activity['bgimage3']}"{/if} alt="">
                            </div>
                        </div>
                        <div class="ft10 color777">游戏页背景</div>
                        <div class="flex flex_j_between">
                            <div class="s_goodimg p_relative">
                                <input class="select_good2img" type="file" onchange="selectGoodimg(this)">
                                <div>
                                    <i class="iconfont icon-webicon308" style="font-size: 35px"></i>
                                    <div class="color777 ft16" style="margin-top: -10px;">游戏页活动须知</div>
                                </div>
                                <img class="good_logo d_desc3" {if !empty($activity['desc3'])}src="{$activity['desc3']}"{/if} alt="">
                            </div>
                        </div>
                        <div class="ft10 color777"><i class="iconfont icon-essential"></i>游戏页活动须知(建议尺寸 800*1000)</div>
                        <div class="flex flex_j_between">
                            <div class="s_goodimg p_relative">
                                <input class="select_good2img" type="file" onchange="selectGoodimg(this)">
                                <div>
                                    <i class="iconfont icon-webicon308" style="font-size: 35px"></i>
                                    <div class="color777 ft16" style="margin-top: -10px;">游戏页标题</div>
                                </div>
                                <img class="good_logo d_title3" {if !empty($activity['title3'])}src="{$activity['title3']}"{/if} alt="">
                            </div>
                        </div>
                        <div class="ft10 color777"><i class="iconfont icon-essential"></i>游戏页标题(建议尺寸 600*200)</div>
                        <div class="flex flex_j_between">
                            <div class="s_goodimg p_relative">
                                <input class="select_good2img" type="file" onchange="selectGoodimg(this)">
                                <div>
                                    <i class="iconfont icon-webicon308" style="font-size: 35px"></i>
                                    <div class="color777 ft16" style="margin-top: -10px;">游戏页游戏规则</div>
                                </div>
                                <img class="good_logo d_rule3" {if !empty($activity['rule3'])}src="{$activity['rule3']}"{/if} alt="">
                            </div>
                        </div>
                        <div class="ft10 color777"><i class="iconfont icon-essential"></i>游戏页游戏规则(建议尺寸 800*360)</div>
                        <div class="flex flex_j_between">
                            <div class="s_goodimg p_relative">
                                <input class="select_good2img" type="file" onchange="selectGoodimg(this)">
                                <div>
                                    <i class="iconfont icon-webicon308" style="font-size: 35px"></i>
                                    <div class="color777 ft16" style="margin-top: -10px;">排行榜背景图</div>
                                </div>
                                <img class="good_logo d_bgimage4" {if !empty($activity['bgimage4'])}src="{$activity['bgimage4']}"{/if} alt="">
                            </div>
                        </div>
                        <div class="ft10 color777">排行榜背景图(不填则为系统默认图片)</div>
                        <div class="flex flex_j_between">
                            <div class="s_goodimg p_relative">
                                <input class="select_good2img" type="file" onchange="selectGoodimg(this)">
                                <div>
                                    <i class="iconfont icon-webicon308" style="font-size: 35px"></i>
                                    <div class="color777 ft16" style="margin-top: -10px;">助力页背景图</div>
                                </div>
                                <img class="good_logo d_bgimage_share" {if !empty($activity['bgimage_share'])}src="{$activity['bgimage_share']}"{/if} alt="">
                            </div>
                        </div>
                        <div class="ft10 color777"><i class="iconfont icon-essential"></i>助力页背景图</div>
                        <div class="flex flex_j_between">
                            <div class="s_goodimg p_relative">
                                <input class="select_good2img" type="file" onchange="selectGoodimg(this)">
                                <div>
                                    <i class="iconfont icon-webicon308" style="font-size: 35px"></i>
                                    <div class="color777 ft16" style="margin-top: -10px;">挑战者背景图</div>
                                </div>
                                <img class="good_logo d_bgimage_my" {if !empty($activity['bgimage_my'])}src="{$activity['bgimage_my']}"{/if} alt="">
                            </div>
                        </div>
                        <div class="ft10 color777">挑战者背景图(不填则为系统默认图片)</div>
                    </div>
                </div>
            </div>
            {if $setting['shop_default']!=1}
            <!--联系方式-->
            {template 'temp/activity_receive'}
            {/if}

            <!--信息收集-->
            {template 'temp/activity_userinfo'}
            <!--分享设置-->
            {template 'temp/activity_share'}
            <!--区域限制设置-->
            {template 'temp/activity_regional'}
        </div>

    </div>


    <!--白色蒙层-->
    <div class="bg_fixed"></div>
    fb_tip
    <!--返回顶部-->
    <div class="go_top">
        <i class="iconfont icon-xiangshang active"></i>
        <div>顶部</div>
    </div>
    <audio id="myaudio" src="" controls="controls" loop="false" hidden="true" />

</div>
{template 'temp/activity_effects'}
<!--底部按钮-->
{template 'temp/common_footer'}

<script>

    // console.log('$template',{php echo json_encode($template)})
    // console.log('$imgcate',{php echo json_encode($imgcate)})
    // console.log('$musiccate',{php echo json_encode($musiccate)})
    console.log('$activity',{php echo json_encode($activity)})
    console.log('$activity[titleimg]',{php echo json_encode($activity['titleimg'])})
    console.log('$case',{php echo json_encode($case)})
</script>
<script>
    var datas={
        // template_id:"{$template[0]['id']}",//模板id
        // bgimage:"{if $activity}{$activity['bgimage']}{else}{$template[0]['bgimage']}{/if}",//模板背景
        // image:"{if $activity}{$activity['image']}{else}{$template[0]['image']}{/if}",//模板图片
        music_id:'',
        music:"{$activity['music']}",
        // effects_imgs:{if !empty($activity['effects_imgs'])}{php echo json_encode($activity['effects_imgs'])}{else}''{/if},
        // effects_id:'',//特效
        // cate_img:'',//更换图片 
    };
    var imgcate={php echo json_encode($imgcate)};
    var musiccate={php echo json_encode($musiccate)};

    function autoPlay(url){
        $('#myaudio').attr('src',url)
        var myAuto = document.getElementById('myaudio');
        myAuto.play();
    }
    var musicSelect = new huiPicker('#musicSelect', function(){
        var val = musicSelect.getVal(1);
        var txt = musicSelect.getText(1);
        if(val==-1){
            autoPlay('')
        }else {
            for (var i = 0; i < musiccate.length; i++) {
                for (var j = 0; j < musiccate[i]['music'].length; j++) {
                    if (musiccate[i]['music'][j]['id'] == val) {
                        autoPlay(musiccate[i]['music'][j]['link'])
                        console.log(musiccate[i]['music'][j]['link'])
                        datas['music']=musiccate[i]['music'][j]['link'];
                        return
                    }
                }

            }
        }
        console.log(musicSelect)
        datas.music_id=val;


    });
    /* 地区选择， 关联型数据 */
    var shopAddress = new huiPicker('#shop_address', function(){
        var sheng   = shopAddress.getText(0);
        var shi     = shopAddress.getText(1);
        var qu      = shopAddress.getText(2);
        hui('#shop_address').val(sheng + shi + qu);
    });
    shopAddress.level = 3;
    shopAddress.bindRelevanceData(cities);
    musicSelect.level = 2;
    // 初始化音乐

    var musics=[{
        value: '-1',
        text: '无',
        children: [
            {
                value: '-1',
                text: '无背景音效'
            }
        ]
    }];
    if(!!musiccate) {
        for (var i=0;i<musiccate.length;i++) {
            var obj={};
            obj['value']=musiccate[i]['id']
            obj['text']=musiccate[i]['title']
            obj['children']=[];
            for (var j=0;j<musiccate[i]['music'].length;j++) {
                obj['children'].push({
                    value: musiccate[i]['music'][j]['id'],
                    text: musiccate[i]['music'][j]['title'],
                    link: musiccate[i]['music'][j]['link']
                })
            }
            musics.push(obj)
        }
        console.log(obj)
    }

    musicSelect.bindRelevanceData(musics);


    $("#datetime-picker1").datetimePicker();



   function selectGoodimg(self) {
       var reader=new FileReader();
       var arr=$(self).val().split('\\');
       arr=arr[arr.length-1].split('/');
       var my=arr[arr.length-1];//这就是要取得的图片名称
       reader.onload=function(e){
           $.post(
               "{php echo $this->createMobileUrl('upload',['op'=>'image'])}",
               {
                   'file':reader.result,
                   'name':my,
                   'size':e.total,
                   'module':"{$_GPC['module']}",
                   'activity_id':"{$activity_id}",
               },
               function (data) {
                   $(self).next().next().attr('src',data.message)
               },'json'
           )
           // console.log( reader.result);  //或者 e.target.result都是一样的，都是base64码
       }
       reader.readAsDataURL(self.files[0])
   }

   //添加奖品
    $('.c_addbtn').click(function () {
        var html=`{template 'temp/prize_detail'}`;
        $('.detail_html').append(html)
    })


    //更换图片分类
    function changeImgcate(self) {
        if(!$(self).hasClass('active')){
            $('.ac_cates div').removeClass('active')
            $(self).addClass('active')
            var idx=Number($(self).attr('data-idx'))
            var html=''
            for(var i=0;i<imgcate[idx]['img'].length;i++){
                html+=`<img onclick="changeImg(this)" src="${imgcate[idx]['img'][i]['image']}" data-id="${imgcate[idx]['img'][i]['id']}" alt="">`
            }
            $('.ac_imgs').html(html)
        }
    }

    // 返回顶部
    // $("body").on("touchstart", function(e) {
    //     e.preventDefault();
    //     startX = e.originalEvent.changedTouches[0].pageX, startY = e.originalEvent.changedTouches[0].pageY;
    // });
    // $("body").on("touchmove", function(e) {
    //     e.preventDefault();
    //     moveEndX = e.originalEvent.changedTouches[0].pageX,
    //         moveEndY = e.originalEvent.changedTouches[0].pageY,
    //         X = moveEndX - startX,
    //         Y = moveEndY - startY;
    //
    //     if(document.documentElement.scrollTop>100){
    //         $('.go_top').fadeIn()
    //     }else{
    //         $('.go_top').fadeOut()
    //     }
    //
    // });
    // $('.go_top').click(function(){
    //     $(window).scrollTop(0);
    //     $('.go_top').fadeOut()
    // })

    function submit(num) {
        var mandatory=false;
        datas['title']=$('.d_title').val();//活动标题
        // datas['image']=$('.h_img').attr('src')//背景主图
        // datas['bgimage']=$('.a_content').css('background-image').slice(5,-2)//背景主图
        datas['titlebgimg']=$('.titlebgimg').attr('src');//标题背景图
        datas['starttime']=$('#datetime-picker1').val()//开始时间
        datas['endtime']=$('#datetime-picker2').val()//结束时间

        if(!datas['title']){tips('请填写活动标题'); return false;}
        if(!datas['starttime']){tips('请填写开始时间'); return false;}
        if(!datas['endtime']){tips('请填写结束时间'); return false;}

        //规则设置
        datas['prize_status']=$('.d_prize_status:checked').val();
        if($('.d_diff').val()==''){tips('请填写差值'); return false;}
        else{datas['diff']=$('.d_diff').val()}
        if($('.d_daynum').val()==''){tips('请填写每日初始次数'); return false;}
        else{datas['daynum']=$('.d_daynum').val()}
        if($('.d_allnum').val()==''){tips('请填写每日上限次数'); return false;}
        else{datas['allnum']=$('.d_allnum').val()}


        if(datas['prize_status']==1){
            if($('.d_min_redpack').val()==''){tips('请填写红包金额'); return false;}
            else{datas['min_redpack']=$('.d_min_redpack').val()}
            if($('.d_max_redpack').val()==''){tips('请填写红包金额'); return false;}
            else{datas['max_redpack']=$('.d_max_redpack').val()}
            if($('.d_random').val()==''){tips('请填写中奖概率'); return false;}
            else{datas['random']=$('.d_random').val()}
            if($('.d_send_name').val()==''){tips('请填写红包名称'); return false;}
            else{datas['send_name']=$('.d_send_name').val()}
            if($('.d_wishing').val()==''){tips('请填写发送红包祝福语'); return false;}
            else{datas['wishing']=$('.d_wishing').val()}
            if($('.d_act_name').val()==''){tips('请填写发送红包名称'); return false;}
            else{datas['act_name']=$('.d_act_name').val()}
        }else if(datas['prize_status']==2){
            if($('.prize_setting2 .good_logo').length==0){tips('请添加奖品'); return false;}
            var prizes=[];
            for (var j = 0; j < $('.prize_setting2 .basic_setting').length;j++) {
                var prizeDom=$($('.prize_setting2 .basic_setting')[j])
                prizes.push({
                    id:prizeDom.find('.good_id').val(),
                    image:prizeDom.find('.good_logo').attr('src'),
                    title:prizeDom.find('.d2_title').val(),
                    odds:prizeDom.find('.d2_odds').val(),
                    num:prizeDom.find('.d2_num').val(),
                    status:prizeDom.find('.weui-switch')[0].checked?'1':0,
                })
                if(!prizes[0].image||!prizes[0].title||!prizes[0].odds||!prizes[0].num){
                    mandatory=true;
                }
            }
            if(mandatory) {
                tips('请填写奖品信息!');
                return false;
            }
            datas['prizes']=prizes;
        }

        if(!$('.d_s_image').attr('src')){tips('请上传分享图'); return false;}
        else{datas['s_image']=$('.d_s_image').attr('src')}
        if(!$('.d_desc3').attr('src')){tips('请上传游戏页活动须知'); return false;}
        else{datas['desc3']=$('.d_desc3').attr('src')}
        if(!$('.d_title3').attr('src')){tips('请上传游戏页标题'); return false;}
        else{datas['title3']=$('.d_title3').attr('src')}
        if(!$('.d_rule3').attr('src')){tips('请上传游戏页游戏规则'); return false;}
        else{datas['rule3']=$('.d_rule3').attr('src')}
        if(!$('.d_bgimage_share').attr('src')){tips('请上传助力页背景图'); return false;}
        else{datas['bgimage_share']=$('.d_bgimage_share').attr('src')}

        datas['bgimage']=$('.d_bgimage').attr('src')
        datas['logo']=$('.d_logo').attr('src')
        datas['titleimg']=$('.d_titleimg').attr('src')
        datas['bgimage2']=$('.d_bgimage2').attr('src')
        datas['title2']=$('.d_title2').attr('src')
        datas['desc2']=$('.d_desc2').attr('src')
        datas['bgimage4']=$('.d_bgimage4').attr('src')
        datas['bgimage_my']=$('.d_bgimage_my').attr('src')

        {if $setting['shop_default']!=1}
        //联系方式
        datas['shop_name']=$('.d_shop_name').val()
        datas['shop_mobile']=$('.d_shop_mobile').val()
        datas['shop_address']=$('.d_shop_address').val()
        datas['shop_code']=$('.d_shop_code').attr('src')
        if(!datas['shop_name']){tips('请填写商家姓名'); return false;}
        if(!datas['shop_mobile']){tips('请填写咨询热线'); return false;}
        //联系地址
        if($('#shop_address').val()){
            datas['shop_province']=$('#shop_address').val().split(' ')[0]
            datas['shop_city']=$('#shop_address').val().split(' ')[1]
            datas['shop_district']=$('#shop_address').val().split(' ')[2]
        }
        {/if}

        //信息收集
        var userinfo=[];
        for (var iiii = 0; iiii < $('.d_userinfo').length;iiii++) {
            userinfo.push({
                title:$($('.d_userinfo')[iiii]).find('.d_u_title').val(),
                checked:$($('.d_userinfo')[iiii]).find('.d_u_checked')[0].checked
            })
        }
        datas['userinfo']=userinfo;

        // 分享设置
        datas['share_img']=$('.d_share_img').attr('src');
        datas['share_title']=$('.d_share_title').val();
        datas['share_desc']=$('.d_share_desc').val();
        if(!datas['share_img']){tips('请上传分享图'); return false;}
        if(!datas['share_title']){tips('请填写分享标题'); return false;}
        if(!datas['share_desc']){tips('请填写分享描述'); return false;}

        //区域限制
        datas['regional']= $('.d_regional:checked').val()//是否需要费用
        if($('.d_regional')[1].checked){
            if($('.d_ak').val()==''){tips('请填写百度地图密钥'); return false;}
            else{datas['ak']=$('.d_ak').val()}
            if($('.d_num').length==0){tips('请添加区域'); return false;}
            else{
                var r_address=[];
                for(var ir=0;ir<$('.d_num').length;ir++){
                    r_address.push($('.d_num')[ir].value)
                }
                datas['r_address']=r_address;
            }
        }

        console.log(datas)
        {if $_GPC['cz']=='bj'}datas['activity_id']="{$activity_id}";{/if}
        $.post(
            "{php echo $this->createMobileUrl('making',['op'=>'post'])}",
            {
                'from':datas,
                'module':"{$_GPC['module']}",
                'case_id':"{$case_id}"
            },
            function (data) {
                tips(data.message);
                if(data.errno==0){
                    setTimeout(function () {
                        if(num=='1'){
                            location.href="./index.php?c=entry&i={$_W['uniacid']}&do=index&activity_id="+data.data.activity_id+"&m={$case['module']}"
                        }else if(num=='2'){
                            location.href="{php echo $this->createMobileUrl('activitys',['op'=>'activitys_detail'])}&activity_id="+data.data.id
                        }
                    },2000)
                }
            },'json'
        )
    }


</script>
{template 'common/footer'}