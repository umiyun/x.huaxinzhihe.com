{template 'header'}
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'/>
<link rel="stylesheet" href="{YOUMI_URL_APP}css/swiper.min.css">
<link rel="stylesheet" href="{YOUMI_URL_APP}css/animate.min.css">
<script src="{YOUMI_URL_APP}js/swiper.min.js"></script>
<script src="{YOUMI_URL_APP}js/swiper.animate.min.js"></script>

<style>
    html,body{
        width: 100%;
        height:100%;
    }
    body{
        font-family:"microsoft yahei";
        margin: 0;
        padding: 0;
    }
    .text-center.footer{
        display: none;
    }
    .swiper-container {
        width: 100%;
        height: 100%;
    }

    .swiper-slide{
        width:100%;
        height:100%;
        overflow: hidden;
    }
    .swiper-slide1,.swiper-slide2,.swiper-slide3,.swiper-slide4,.swiper-slide5{
        background:url({php echo tomedia($setting['p1_bg'])}) no-repeat left top;
        background-size: 100% 100%;
    }
    img{
        display:block;
    }
    .swiper-pagination-bulvar {
        width: 6px;
        height: 6px;
        background: #fff;
        opacity: .4;
    }
    .swiper-pagination-bulvar-active {
        opacity: 1;
    }
    @-webkit-keyframes start {
        0%,30% {opacity: 0;-webkit-transform: translate(0,10px);}
        60% {opacity: 1;-webkit-transform: translate(0,0);}
        100% {opacity: 0;-webkit-transform: translate(0,-8px);}
    }
    @-moz-keyframes start {
        0%,30% {opacity: 0;-moz-transform: translate(0,10px);}
        60% {opacity: 1;-moz-transform: translate(0,0);}
        100% {opacity: 0;-moz-transform: translate(0,-8px);}
    }
    @keyframes start {
        0%,30% {opacity: 0;transform: translate(0,10px);}
        60% {opacity: 1;transform: translate(0,0);}
        100% {opacity: 0;transform: translate(0,-8px);}
    }
    @keyframes tm1 {
        0% {transform: translateX(180%);}
        100% {transform: translateX(-130%);}
    }
    @keyframes tm2 {
        0% {transform: translateX(160%);}
        100% {transform: translateX(-130%);}
    }
    @keyframes load {
        0% {
            transform: translate(0,0);
        }
        13%{
            transform: translate(-15%,-12%);
        }
        33%{
            transform: translate(-15%,-12%);
        }
        46%{
            transform: translate(3%,-24%);
        }
        66%{
            transform: translate(3%,-24%);
        }
        80% {
            transform: translate(-19%,-46%);
        }
        100% {
            transform: translate(-19%,-46%);
        }
    }
    .ani{
        position:absolute;
    }
    .infinite{
        -webkit-animation-iteration-count: infinite;
        -moz-animation-iteration-count: infinite;
        -o-animation-iteration-count: infinite;
        animation-iteration-count: infinite;
    }

    /*音乐*/

    @-webkit-keyframes change {
        from {
            transform: rotate(0deg)
        }
        to {
            transform: rotate(360deg)
        }
    }
    @-webkit-keyframes point {
        from {
            opacity: 0.2
        }
        to {
            opacity: 1
        }
    }
    .music{
        position: fixed;
        right: 10px;
        top: 10%;
        border:1px solid #fff;
        z-index: 999999;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: url(http://qiniu.longyue8.com/tgaaa.png) no-repeat;
        background-size: cover;
        cursor: pointer;
    }
    .muc{
        background: url(http://qiniu.longyue8.com/tgaaa.gif) no-repeat;
        background-size: cover;
        animation: change 1s linear 0s infinite;
        -moz-animation: change 1s linear 0s infinite;
        -webkit-animation: change 1s linear 0s infinite;
        -o-animation: change 1s linear 0s infinite;
    }
    .tips{
        width: 30%;
        position: fixed;
        top: 30%;
        left: 35%;
        padding: 10px;
        background: #aaa;
        color: #fff;
        z-index: 999;
        text-align: center;
        border-radius: 10px;
        display: none;
    }


    .array{
        position:absolute;z-index:99;
        -webkit-animation: start 1.5s infinite ease-in-out;
        width: 20px;
        height: 15px;
        bottom: 2px;
        left: 47%;
    }
    .logo1{
        width: 35%;
        top: 2%;
        left: 2%;
    }
    .logo2{
        width: 35%;
        top: 2%;
        right: 2%;
    }
    .swiper-slide1 .title1{
        width: 70%;
        left: 0;
        top: 15%;
    }
    .swiper-slide1 .title2{
        width: 30%;
        left: 5%;
        top: 42%;
    }
    .swiper-slide1 .title3{
        width: 44%;
        left: 5%;
        top: 72%;
    }
    .swiper-slide1 .img1{
        width: 43%;
        right: 0;
        bottom: 0;
    }

    .swiper-slide2 .title1{
        width: 78%;
        left: 0;
        top: 11%;
    }
    .swiper-slide2 .title2{
        width: 35%;
        left: 12%;
        top: 40%;
    }
    .swiper-slide2 .title3{
        width: 30%;
        left: 10%;
        top: 54%;
    }
    .swiper-slide2 .title4{
        width: 40%;
        left: 10%;
        top: 75%;
    }
    .swiper-slide2 .img1,.swiper-slide3 .img1{
        width: 55%;
        right: 0;
        bottom: 0;
    }

    .swiper-slide2 .img2{
        width: 65%;
        right: 0;
        bottom: 0;
    }
    .swiper-slide2 .point2,.swiper-slide3 .point2{
        width: 13%;
        right: 10%;
        top: 12%;
    }

    .swiper-slide3 .title1{
        width: 77%;
        left: 0;
        top: 13%;
    }
    .swiper-slide3 .title2{
        width: 42%;
        left: 0;
        top: 42%;
    }
    .swiper-slide3 .title3{
        width: 11%;
        right: 5%;
        top: 13%;
    }
    .swiper-slide3 .img1{
        width: 80%;
        right: 10%;
        bottom: 4%;
     }

    img.load {
        width: 115%;
        margin-left: 5%;
    }
    .swiper-slide4 .title1{
        width: 75%;
        left: 0;
        top: 3%;
    }
    .swiper-slide4 .title2{
        top: 29%;
        width: 47%;
        left: 0;
    }
    .swiper-slide4 .title3{
        width: 11%;
        right: 7%;
        top: 4%;
    }
    .swiper-slide4 .img1{
        top: 38%;
        width: 84%;
        left: 8%;
    }
    .activity{
        z-index: 10;
        background: #fff;
        margin: 5% 10%;
        width: 80%;
        padding: 2%;
        border-radius: 10px;
        box-sizing: border-box;
    }

    @media only screen and (width: 375px) and (min-height: 690px){
    }

    .flex{
        display: flex;
        display: -webkit-flex;
    }
    .flex_j_center{
        justify-content: center;
        -webkit-justify-content: center;
    }
    .flex_j_around{
        justify-content: space-around;
        -webkit-justify-content: space-around;
    }
    .flex_j_between{
        justify-content: space-between;
        -webkit-justify-content: space-between;
    }
    .flex_a_center{
        align-items: center;
        -webkit-align-items: center;
    }
    .p_relative{
        position: relative;
    }
    .p_absolute{
        position: absolute;
    }
    .p4_inputs>div{
        width: 70%;
        left: 15%;
        margin-bottom: 15px;
    }
    .p4_inputs{
        position: absolute;
        top: 75%;
        width: 100%;
    }
    .p4_inputs input{
        background: rgba(13,13,13,0.3);
        border: 1px solid transparent;
        height: 20px;
        border-radius: 3px;
        padding-left: 42px;
        flex: 1;
        -webkit-flex: 1;
    }
    .p4_inputs span{
        font-size: 12px;
        word-break: keep-all;
    }
    .p4_inputs img{
        position: absolute;
        width: 25px;
        left: 19%;
    }
    textarea::-webkit-input-placeholder,input::-webkit-input-placeholder{
        color: #888;
        font-size: 12px;
    }
    .p4_btns{
        position: absolute;
        top: 90%;
        width: 70%;
        left: 15%;
        font-size: 12px;
    }
    .p4_btns>div{
        color: #fff;
        background: #007a86;
        border-radius: 3px;
        padding: 7px 0;
        width: 105px;
        text-align: center;
        opacity: 0.8;
    }
    .bg_fixed{
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.9);
        z-index: 5;
    }
    .p4_shark{
        background: #666!important;
        display: none;
    }
    @media screen and (max-width: 350px){
        .d_time,.list{font-size: 14px}
        .p5_btns{font-size: 12px}
        .p4_inputs img{left: 16%}
    }

    .bg_fixed1{
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.65);
        z-index: 40;
    }
    .code{
        position: fixed;
        top: 14%;
        width: 80%;
        left: 10%;
        z-index: 50;
    }
</style>
</head>

<body>
<div class="swiper-container">
    <div id="music" class="music muc">
        <audio id="audiojs" src="{$setting['music']}" autoplay loop></audio>
    </div>
    {if $member['follow']=='0'}
    <div class="bg_fixed1"></div>
    <img class="code" src="{php echo tomedia($setting['code'])}" alt="">
    {/if}
    <div class="swiper-wrapper">
        <!-------------slide1----------------->
        <section class="swiper-slide swiper-slide1">
            <img src="{php echo tomedia($setting['logo1'])}" class="ani resize logo1" swiper-animate-effect="fadeIn" swiper-animate-duration="0.5s" swiper-animate-delay="0">
            <img src="{php echo tomedia($setting['logo2'])}" class="ani resize logo2" swiper-animate-effect="fadeIn" swiper-animate-duration="0.5s" swiper-animate-delay="0">

            <img src="{php echo tomedia($setting['p1_title1'])}" class="ani resize title1" swiper-animate-effect="bounceInLeft" swiper-animate-duration="2s" swiper-animate-delay="0.1s">
            <img src="{php echo tomedia($setting['p1_title2'])}" class="ani resize title2" swiper-animate-effect="bounceInLeft" swiper-animate-duration="2s" swiper-animate-delay="0.6s">
            <img src="{php echo tomedia($setting['p1_title3'])}" class="ani resize title3" swiper-animate-effect="fadeInUp" swiper-animate-duration="2s" swiper-animate-delay="1s">

            <img src="{YOUMI_URL_APP}images/p1_img1.png" class="ani resize img1" swiper-animate-effect="fadeIn" swiper-animate-duration="1.5s" swiper-animate-delay="1s">

            <img src="{YOUMI_URL_APP}images/arrow.png" class="array resize">
        </section>
        <!---------------slide2-------------->
        <section class="swiper-slide swiper-slide2">
            <img src="{php echo tomedia($setting['logo1'])}" class="ani resize logo1" swiper-animate-effect="fadeIn" swiper-animate-duration="0.5s" swiper-animate-delay="0">
            <img src="{php echo tomedia($setting['logo2'])}" class="ani resize logo2" swiper-animate-effect="fadeIn" swiper-animate-duration="0.5s" swiper-animate-delay="0">

            <img src="{php echo tomedia($setting['p2_title1'])}" class="ani resize title1" swiper-animate-effect="bounceInLeft" swiper-animate-duration="2s" swiper-animate-delay="0.1s">
            <img src="{php echo tomedia($setting['p2_title2'])}" class="ani resize title2" swiper-animate-effect="bounceInLeft" swiper-animate-duration="2s" swiper-animate-delay="0.6s">
            <img src="{php echo tomedia($setting['p2_title3'])}" class="ani resize title3" swiper-animate-effect="fadeInUp" swiper-animate-duration="2s" swiper-animate-delay="1s">
            <img src="{php echo tomedia($setting['p2_title4'])}" class="ani resize title4" swiper-animate-effect="fadeInUp" swiper-animate-duration="2s" swiper-animate-delay="1s">

            <img src="{YOUMI_URL_APP}images/p2_img1.png" class="ani resize img1" swiper-animate-effect="fadeIn" swiper-animate-duration="1.5s" swiper-animate-delay="1s">

            <img src="{YOUMI_URL_APP}images/arrow.png" class="array resize">
        </section>
                <!---------------slide3-------------->
        <section class="swiper-slide swiper-slide3">
            <img src="{php echo tomedia($setting['logo1'])}" class="ani resize logo1" swiper-animate-effect="fadeIn" swiper-animate-duration="0.5s" swiper-animate-delay="0">
            <img src="{php echo tomedia($setting['logo2'])}" class="ani resize logo2" swiper-animate-effect="fadeIn" swiper-animate-duration="0.5s" swiper-animate-delay="0">

            <img src="{php echo tomedia($setting['p3_title1'])}" class="ani resize title1" swiper-animate-effect="bounceInLeft" swiper-animate-duration="2s" swiper-animate-delay="0.1s">
            <img src="{php echo tomedia($setting['p3_title2'])}" class="ani resize title2" swiper-animate-effect="bounceInLeft" swiper-animate-duration="2s" swiper-animate-delay="0.6s">
            <img src="{YOUMI_URL_APP}images/p3_title3.png" class="ani resize title3" swiper-animate-effect="fadeInRight" swiper-animate-duration="2s" swiper-animate-delay="1s">

            <img src="{php echo tomedia($setting['p3_title3'])}" class="ani resize img1" swiper-animate-effect="fadeIn" swiper-animate-duration="1.5s" swiper-animate-delay="1s">

            <img src="{YOUMI_URL_APP}images/arrow.png" class="array resize">
        </section>
        <!---------------slide4-------------->
        <section class="swiper-slide swiper-slide4">
            <img src="{php echo tomedia($setting['p4_title1'])}" class="ani title1" swiper-animate-effect="fadeIn" swiper-animate-duration="1s" swiper-animate-delay="0s">
            <img src="{php echo tomedia($setting['p4_title2'])}" class="ani title2" swiper-animate-effect="fadeIn" swiper-animate-duration="1s" swiper-animate-delay="0.5s">
            <img src="{YOUMI_URL_APP}images/p3_title3.png" class="ani title3" swiper-animate-effect="fadeIn" swiper-animate-duration="1s" swiper-animate-delay="1s">

            <img src="{YOUMI_URL_APP}images/p4_img1.png" class="ani resize img1" swiper-animate-effect="fadeIn" swiper-animate-duration="1.5s" swiper-animate-delay="1s">

            <div class="p4_inputs ani" swiper-animate-effect="fadeIn" swiper-animate-duration="1s" swiper-animate-delay="1.2s">
                <div class="p4_name flex flex_a_center flex_j_center p_relative">
                    <span>姓名：</span>
                    <input class="realname" type="text" placeholder="请输入您的姓名" value="{$cut_my['realname']}">
                    <img src="{YOUMI_URL_APP}images/p4_pan.png" alt="">
                </div>
                <div class="p4_mobile flex flex_a_center flex_j_center p_relative">
                    <span>电话：</span>
                    <input class="mobile" type="tel" placeholder="请输入您的电话" value="{$cut_my['mobile']}">
                    <img src="{YOUMI_URL_APP}images/p4_pan.png" alt="">
                </div>
            </div>
            <div class="p4_btns ani flex flex_j_between" swiper-animate-effect="fadeIn" swiper-animate-duration="1s" swiper-animate-delay="1.5s">
                <div onclick="$('.activity,.bg_fixed').fadeIn()">抢票规则</div>
                <div onclick="p4submit(this)" style="{if $cut_my['status']==1}display: none{/if}">提交</div>
                <div class="p4_shark" data-cut_id="{$cut_my['id']}" style="{if $cut_my['status']==1}display: block{/if}">拿起手机摇一摇</div>
            </div>

            <div class="ani activity">
                <img onclick="$('.activity,.bg_fixed').fadeOut()" src="{php echo tomedia($setting['p4_rule'])}" class="rule" style="width: 100%">
            </div>
            <div class="bg_fixed"></div>
         </section>

    </div>

    <div class="swiper-pagination" style="display: none"></div>
    <div class="tips"></div>
</div>
<script>

    var audio=document.getElementsByTagName('audio')[0];
    $('#music').click(function(){
        if(audio.paused){
            audio.play();
            $(this).attr('class','music muc')
        }else{
            audio.pause();
            $(this).attr('class','music')
        }
    });
    document.addEventListener('DOMContentLoaded', function () {
        function audioAutoPlay() {
            var audio = document.getElementById('audiojs');
            audio.play();
            document.addEventListener("WeixinJSBridgeReady", function () {
                audio.play();
            }, false);
        }
        audioAutoPlay();
    });
    if (/i(Phone|P(o|a)d)/.test(navigator.userAgent)) {
        $(document).one('touchstart',
            function(e) {
                $('#audiojs').get(0).touchstart = true;
                $('#audiojs').get(0).play();
                return false;
            });
    }
</script>
<script>
    var page=1;
    scaleW=window.innerWidth/320;
    scaleH=window.innerHeight/480;
    var resizes = document.querySelectorAll('.resize');

    var mySwiper = new Swiper ('.swiper-container', {
        direction : 'vertical',
        pagination: '.swiper-pagination',
        //virtualTranslate : true,
        mousewheelControl : true,
        onInit: function(swiper){
            swiperAnimateCache(swiper);
            swiperAnimate(swiper);
        },
        onSlideChangeEnd: function(swiper){
            swiperAnimate(swiper);

        },
        onTransitionEnd: function(swiper){
            swiperAnimate(swiper);
            if($('.swiper-slide4').hasClass('swiper-slide-active')){
                page=4;
            }else{
                page=1
            }
        },


        watchSlidesProgress: true,

        onProgress: function(swiper){
            for (var i = 0; i < swiper.slides.length; i++){
                var slide = swiper.slides[i];
                var progress = slide.progress;
                var translate = progress*swiper.height/4;
                scale = 1 - Math.min(Math.abs(progress * 0.5), 1);
                var opacity = 1 - Math.min(Math.abs(progress/2),0.5);
                slide.style.opacity = opacity;
                es = slide.style;
                es.webkitTransform = es.MsTransform = es.msTransform = es.MozTransform = es.OTransform = es.transform = 'translate3d(0,'+translate+'px,-'+translate+'px) scaleY(' + scale + ')';
            }
        },

        onSetTransition: function(swiper, speed) {
            for (var i = 0; i < swiper.slides.length; i++){
                es = swiper.slides[i].style;
                es.webkitTransitionDuration = es.MsTransitionDuration = es.msTransitionDuration = es.MozTransitionDuration = es.OTransitionDuration = es.transitionDuration = speed + 'ms';
            }
        },
    })

    // 提示
    function tips(txt,timer){
        $('.tips').html(txt).fadeIn()
        setTimeout(function(){$('.tips').fadeOut()},timer||1500);
    }

    // 提交
    function p4submit(self){
        var realname=$('.realname').val();
        var mobile=$('.mobile').val();
        if(!realname){
            tips('请输入姓名');
            return false;
        }
        if(!mobile){
            tips('请输入手机号');
            return false;
        }
        var myreg = /^(((13[0-9]{1})|(14[0-9]{1})|(15[0-9]{1})|(16[0-9]{1})|(17[0-9]{1})|(18[0-9]{1})|(19[0-9]{1}))+\d{8})$/;
        if (!myreg.test(mobile)) {
            tips('请输入有效的手机号码');
            return false;
        }
        $.post(
            "{php echo $this->createMobileUrl('index',array('op' =>'apply'))}",
            {
                'realname':realname,
                'mobile':mobile
            },
            function (data) {
                tips(data.message);
                if(data.errno==0){
                    $('.p4_shark').attr('data-cut_id',data.id)
                    $(self).hide().next().show()
                }
            },'json'
        )
    }
    console.log({php echo json_encode($setting)})
    console.log({php echo json_encode($cut_my)})
    console.log('$ticket_surplus',{php echo json_encode($ticket_surplus)})
</script>
<script>
    // 摇一摇
    // document.addEventListener("WeixinJSBridgeReady", function () {
    //     createjs.Sound.registerSound({ src: "{YOUMI_URL_APP}music/2.mp3", id: "myAudio" });
    // }, false);

    var isajax = true;

    var SHAKE_THRESHOLD = 3000;
    var last_update = 0;
    var x = y = z = last_x = last_y = last_z = 0;
    function init() {
        if (window.DeviceMotionEvent) {
            window.addEventListener('devicemotion', deviceMotionHandler, false);
        } else {
            alert('not support mobile event');
        }
    }
    function deviceMotionHandler(eventData) {
        var acceleration = eventData.accelerationIncludingGravity;
        var curTime = new Date().getTime();
        if ((curTime - last_update) > 100) {
            var diffTime = curTime - last_update;
            last_update = curTime;
            x = acceleration.x;
            y = acceleration.y;
            z = acceleration.z;
            var speed = Math.abs(x + y + z - last_x - last_y - last_z) / diffTime * 10000;

            if (speed > SHAKE_THRESHOLD&&page==4) {
                if(!isajax){
                    return false;
                }
                isajax=false;
                $.post(
                    "{php echo $this->createMobileUrl('index',array('op' =>'receive'))}",
                    function (data) {
                        tips(data.message);
                        if(data.errno==0){
                            setTimeout(function(){
                                location.href="{php echo $this->createMobileUrl('index',array('op' =>'detail'))}&id="+$('.p4_shark').attr('data-cut_id')
                            },2000);
                        }else{
                            isajax=true;
                        }
                    },'json'
                )
            }
            last_x = x;
            last_y = y;
            last_z = z;
        }
    }
    init();


</script>
{template 'common/footer'}
